#!/bin/sh

Adding(){
echo "Writing changes to pacman.conf..."
sudo mv /tmp/pacman.conf2 /etc/pacman.conf
sudo pacman -Syy
echo "DONE"
}

Unnecessary(){
pacman -Qqtd > /tmp/package-files.txt
yad --title "Unnecessary Packages" --skip-taskbar --form --center --text-align=center --width=300 --height=100 \
--text="Remove clutter with ease" \
--field="View Unnecessary Packages In Terminal:fbtn" "xterm -e nano /tmp/package-files.txt" \
--field="Remove All Unnecessary Packages:fbtn" "xterm -e sudo pacman -Rs $(pacman -Qqdt) --noconfirm" \
--button="Back":1
rm /tmp/package-files.txt
}

Update(){
if [ -f /usr/bin/octopi ]; then
octopi
fi

if [ -f /usr/bin/pamac-updater ]; then
pamac-updater
fi
}

Journal(){
journalctl --vacuum-time=3d && sync
Notice

}

Cache(){
pacman -Scc --noconfirm
Notice

}

Clean(){
paccache -ruk0
Notice

}

Notice()
{
yad --center --width=150 --height=30 --skip-taskbar --undecorated --no-buttons --form --timeout="1" --text-align=center --title="Reborn Maintenance" \
--text="DONE!" \

}

Save()
{
SAVING=$(sed '1q;d' /tmp/saving.txt)
echo "Saving Files To $SAVING"
sudo pacman -Qqen > $SAVING/packages-repository.txt
sudo pacman -Qqem > $SAVING/packages-AUR.txt
echo "Done"
Notice

}

Recover()
{
SAVING=$(sed '1q;d' /tmp/saving.txt)
echo "Recovering Files From $SAVING..."
sudo pacman --needed -S - < $SAVING/packages-repository.txt --noconfirm
cat $SAVING/packages-AUR.txt | xargs yaourt -S --needed --noconfirm
echo "Done"
}

StartHere()
{

echo "Setting Directory..."
yad --center --width=350 --height=100 --form --separator='' --title="Reborn Recovery" --save --field="Save To:":CDIR >> /tmp/saving.txt
SAVING=$(sed '1q;d' /tmp/saving.txt)
echo "Using $SAVING Directory"
Next
}

Grub()
{
sudo os-prober
sudo grub-mkconfig -o /boot/grub/grub.cfg
}

Downgrading()
{

echo "Setting Package..."
yad --center --width=300 --height=30 --form --separator='' --title="Reborn Repair" --save --field="Package Name:" >> /tmp/packaging.txt
SAVED=$(sed '1q;d' /tmp/packaging.txt)
echo "Using $SAVED Package"
After
}

After()
{

SAVED=$(sed '1q;d' /tmp/packaging.txt)

yad --form --center --title "Reborn Repair" --width=400 \
--field="Selected Package::RO" "$SAVED" \
--field='Downgrade package:FBTN' "xterm -e downgrade $SAVED" \
--button='gtk-quit:1'
rm /tmp/packaging.txt

}

Next()
{

SAVING=$(sed '1q;d' /tmp/saving.txt)

yad --form --center --title "Reborn Recovery" --width=400 \
--field="Folder to Save Package Lists To::RO" "$SAVING" \
--field='Create Package List:FBTN' '@bash -c "Save"' \
--field='Recover Packages From List:FBTN' 'xterm -e "Recover"' \
--button='gtk-quit:1'
rm /tmp/saving.txt

}

Removing()
{

echo "Setting Package..."
yad --center --width=300 --height=30 --form --separator='' --title="Reborn Repair" --save --field="Package to Remove:" >> /tmp/packaging2.txt
SAVED=$(sed '1q;d' /tmp/packaging2.txt)
echo "Will Remove $SAVED Package"
Removed
}

Removed()
{

SAVED=$(sed '1q;d' /tmp/packaging2.txt)

yad --form --center --title "Reborn Repair" --width=400 \
--field="Selected Package::RO" "$SAVED" \
--field='Remove Package:FBTN' "xterm -e sudo pacman -Rdd $SAVED --noconfirm" \
--button='gtk-quit:1'
rm /tmp/packaging2.txt

}

export -f Adding Unnecessary Update Journal Cache Clean Save Recover StartHere Next Notice Grub Downgrading After Removing Removed


yad --plug=23456 --tabnum=1 --form --center --text-align=center \
--text="The following new Desktop configurations are available for install:" \
--field='Pantheon!!'"Pantheon is the desktop environment that Elementary OS runs on. While true Pantheon is too unstable for Reborn OS to offer, we have tried to offer the next best thing. By selecting Pantheon, you will get Elementary OS's good looks on a highly customized desktop running Cinnamon underneath. Through this, you will be able to run the majority of Elementary OS's applications and experience their stunning style and theming - all in a stable system.:fbtn" "xterm -e sudo pacman elementary-cosmic-reborn elementary-theme --noconfirm" \
--field='Cinnamon customized like Windows!!'"While I am sure you have all heard of Windows, this option does NOT truly offer you straight up Windows. This is Linux after all, not Microsoft. However, what this option DOES allow you to experience, is a Windows-like desktop running Cinnamon underneath, made to look and act like the Windows 10 you are already familiar with. Made with Linux newbies specifically in mind, this option should hopefully ensure you have an easy, hassle free transition to Linux.:fbtn" "xterm -e sudo pacman -S cinnamon-cosmic-reborn windows-theme --noconfirm" &

yad --plug=23456 --tabnum=2 --form --center --text-align=center \
--text="Please consider updating your Reborn mirrorlist on your system (THIS MUST BE DONE BEFORE ADDING OTHER DESKTOPS):" \
--field="Use Mettke's Server For Reborn'!!""We are no longer updating our Github mirror for our repository due to its file size limits. To take advantage of updated packages for Reborn, please click this button.:fbtn" 'xterm -e "Adding"' &

yad --plug=23456 --tabnum=3 --form --title="System Maintenance" --center --text-align=center --columns=2 \
--text="A few simple commands to keep Reborn working flawlessly and your system clean" \
--field="Clear Cache:fbtn" '@bash -c "Cache"' \
--field="Clean Journal:fbtn" '@bash -c "Journal"' \
--field="Clean Built Packages:fbtn" '@bash -c "Clean"' \
--field="Rank Mirrors:fbtn" "xterm -e sudo reflector --verbose --age 8 --fastest 128 --latest 64 --number 32 --sort rate --save /etc/pacman.d/mirrorlist" \
--field="Unnecessary Packages:fbtn" '@bash -c "Unnecessary"' \
--field="Update System:fbtn" '@bash -c "Update"' &

yad --plug=23456 --tabnum=4 --form --title="System Repair" --center --text-align=center --columns=2 \
--text="A few simple steps to prevent Reborn from disaster and nurse it back to health" \
--field="Save / Recover Programs:fbtn" '@bash -c "StartHere"' \
--field="Rebuild Grub:fbtn" 'xterm -e "Grub"' \
--field="Reinstall Grub (EFI):fbtn" "xterm -e grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=Reborn-Grub" \
--field="Downgrade:fbtn" '@bash -c "Downgrading"' \
--field="Remove Package (Leaving Dependencies):fbtn" '@bash -c "Removing"' \
--field="Ask Actual Humans on the Forum:fbtn" "@bash -c xdg-open https://rebornos.freeforums.net" &

yad --notebook --center --key=23456 --tab="New Applications" --tab="Repositories" --tab="Maintenance" --tab="Repair" --button=gtk-quit:1 \
--title="Reborn Improvements" \
